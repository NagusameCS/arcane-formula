*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0806;--panel:#131008;--border:#2a2015;--gold:#ffd700;--gold-dim:#aa8800;
  --text:#d4c5a0;--dim:#665533;--blue:#4488ff;--red:#ff4455;--green:#44cc66;
}
body{background:var(--bg);color:var(--text);font-family:'Courier New',monospace;overflow:hidden}
canvas{display:block;width:100vw;height:100vh;image-rendering:pixelated;image-rendering:crisp-edges}
.hidden{display:none!important}
.overlay{position:fixed;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.95)}

/* ── BUTTONS ── */
.btn-gold{
  background:linear-gradient(180deg,#2a2010,#14100a);border:1px solid var(--gold);color:var(--gold);
  font-family:inherit;font-size:14px;padding:10px 28px;cursor:pointer;letter-spacing:3px;
  transition:all .15s;text-transform:uppercase;
}
.btn-gold:hover{background:#2a2010;box-shadow:0 0 20px rgba(255,215,0,.2)}

/* ── LOBBY ── */
.lobby-box{text-align:center;max-width:420px;width:100%}
.lobby-title{font-size:32px;color:var(--gold);letter-spacing:10px;text-shadow:0 0 30px rgba(255,215,0,.3);margin-bottom:6px}
.lobby-sub{color:var(--dim);font-size:13px;margin-bottom:35px}
.lobby-actions{display:flex;flex-direction:column;gap:12px;align-items:center}
.lobby-divider{color:#444;font-size:12px;margin:4px 0}
.join-row{display:flex;gap:8px}
.join-row input{
  background:var(--panel);border:1px solid var(--border);color:var(--gold);font-family:inherit;
  font-size:16px;padding:10px 14px;width:150px;text-align:center;letter-spacing:4px;outline:none;
  text-transform:uppercase;
}
.join-row input:focus{border-color:var(--gold)}
.room-status{margin-top:18px;font-size:12px;color:var(--dim);min-height:18px}
.room-code{
  margin-top:12px;font-size:28px;color:var(--gold);letter-spacing:8px;
  text-shadow:0 0 20px rgba(255,215,0,.4);padding:12px 24px;border:1px dashed var(--gold-dim);
  display:inline-block;
}

/* ── SPELLBOOK CAROUSEL ── */
.spellbook-wrap{width:100%;max-width:800px;padding:20px}
.carousel-header{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:16px}
.carousel-arrow{
  background:none;border:1px solid var(--border);color:var(--gold);font-size:20px;width:36px;height:36px;
  cursor:pointer;font-family:inherit;transition:border-color .15s;
}
.carousel-arrow:hover{border-color:var(--gold)}
.carousel-dots{display:flex;gap:8px}
.carousel-dot{
  width:10px;height:10px;border:1px solid var(--border);background:transparent;cursor:pointer;
  transition:all .15s;
}
.carousel-dot.active{background:var(--gold);border-color:var(--gold);box-shadow:0 0 6px rgba(255,215,0,.4)}

.carousel-viewport{overflow:hidden;position:relative}
.carousel-track{display:flex;transition:transform .3s ease}

.spell-card{
  flex:0 0 100%;padding:16px 24px;min-height:420px;
  background:var(--panel);border:1px solid var(--border);
  display:flex;flex-direction:column;gap:12px;
}

/* card header */
.card-top{display:flex;align-items:center;gap:12px}
.card-key{
  width:32px;height:32px;border:1px solid var(--gold);color:var(--gold);
  display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:bold;flex-shrink:0
}
.card-name{
  flex:1;background:transparent;border:none;border-bottom:1px solid var(--border);
  color:var(--text);font-family:inherit;font-size:16px;padding:4px 0;outline:none;
}
.card-name:focus{border-color:var(--gold)}
.card-cost{display:flex;align-items:center;gap:6px;color:var(--dim);font-size:12px}
.card-cost input{
  width:50px;background:var(--bg);border:1px solid var(--border);color:var(--gold);
  font-family:inherit;font-size:14px;text-align:center;padding:4px;outline:none;
}
.card-cost input:focus{border-color:var(--gold)}

/* LaTeX preview */
.latex-preview{
  min-height:50px;padding:12px;background:var(--bg);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;overflow-x:auto;
}
.latex-preview .katex{font-size:1.1em}

/* block editor */
.block-editor-area{flex:1;display:flex;flex-direction:column;gap:8px}
.formula-label{font-size:11px;color:var(--dim);letter-spacing:2px;text-transform:uppercase}
.block-workspace{
  min-height:48px;padding:8px;background:var(--bg);border:1px solid var(--border);
  display:flex;align-items:center;flex-wrap:wrap;gap:4px;cursor:pointer;
  position:relative;
}
.block-workspace.drop-target{border-color:var(--gold);box-shadow:inset 0 0 8px rgba(255,215,0,.1)}

/* blocks palette */
.block-palette{
  display:flex;flex-wrap:wrap;gap:4px;padding:8px;background:rgba(0,0,0,.3);
  border:1px solid #1a1510;max-height:120px;overflow-y:auto;
}
.block-palette-section{
  display:flex;flex-wrap:wrap;gap:3px;align-items:center;
  padding-right:8px;margin-right:4px;border-right:1px solid #1a1510;
}
.block-palette-section:last-child{border-right:none}

/* individual blocks */
.block{
  display:inline-flex;align-items:center;padding:3px 7px;font-size:12px;cursor:grab;
  user-select:none;white-space:nowrap;border-radius:2px;gap:3px;
  transition:box-shadow .1s;position:relative;
}
.block:hover{box-shadow:0 0 6px rgba(255,255,255,.1)}
.block.dragging{opacity:.5;cursor:grabbing}
.block-num{background:#2a4466;color:#88bbff;border:1px solid #3a5577}
.block-var{background:#2a3a22;color:#88cc77;border:1px solid #3a4a33}
.block-op{background:#4a3322;color:#ffaa66;border:1px solid #5a4433}
.block-func{background:#3a2244;color:#bb88ff;border:1px solid #4a3355}
.block-slot{
  display:inline-flex;min-width:24px;min-height:22px;border:1px dashed #555;
  background:#080604;align-items:center;justify-content:center;padding:0 4px;cursor:pointer;
}
.block-slot.active{border-color:var(--gold);background:#1a1508}
.block-slot .block{margin:0}
.block-remove{
  position:absolute;top:-6px;right:-6px;width:14px;height:14px;background:#522;color:#f88;
  border:1px solid #833;font-size:9px;display:none;align-items:center;justify-content:center;
  cursor:pointer;z-index:5;line-height:1;
}
.block:hover .block-remove{display:flex}

/* ── SPELLBOOK BOTTOM ── */
.spellbook-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:16px}
.ready-status{font-size:12px;color:var(--dim)}
.btn-ready{font-size:16px;padding:12px 40px}

/* ── HUD ── */
#hud{position:fixed;top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:flex-start;padding:10px 16px;z-index:50;pointer-events:none}
.hud-left,.hud-right{width:260px}
.hud-center{flex:1;display:flex;justify-content:center;padding-top:4px}
.hud-right{text-align:right}
.hud-label{font-size:10px;letter-spacing:3px;color:#665;margin-bottom:3px}
.hp-bar,.mana-bar{height:14px;background:#1a1510;border:1px solid var(--border);margin-bottom:3px;position:relative;overflow:hidden}
.hp-fill{height:100%;background:linear-gradient(90deg,#992222,#cc3333);width:100%;transition:width .2s}
.hp-enemy{background:linear-gradient(90deg,#cc3333,#992222)}
.mana-fill{height:100%;background:linear-gradient(90deg,#224488,#4488ff);width:100%;transition:width .1s;position:absolute;top:0;left:0}
.mana-locked{height:100%;background:#1a1a44;width:0;position:absolute;top:0;right:0;transition:width .1s}
.bar-text{position:absolute;right:6px;top:0;line-height:14px;font-size:9px;color:rgba(255,255,255,.5);z-index:2}
.spell-keys{display:flex;gap:3px;margin-top:5px}
.spell-key-hud{
  width:38px;height:24px;background:rgba(20,16,10,.8);border:1px solid var(--border);
  display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:8px;color:#665;pointer-events:auto;
}
.spell-key-hud .key-num{font-size:10px;color:var(--gold);font-weight:bold}
.spell-key-hud.on-cd{opacity:.4;border-color:#553}
.spell-key-hud.no-mana{opacity:.3;border-color:#533}
.dash-cd{font-size:10px;color:var(--dim);letter-spacing:2px}
.dash-cd.ready{color:var(--gold)}

/* ── VICTORY ── */
#victory-screen{flex-direction:column;gap:14px}
#victory-screen h1{font-size:42px;color:var(--gold);letter-spacing:8px;text-shadow:0 0 40px rgba(255,215,0,.5)}
#victory-screen p{color:var(--dim);font-size:14px}
