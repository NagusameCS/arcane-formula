<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Formula</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%230a0806'/%3E%3Crect x='13' y='2' width='6' height='6' fill='%23ffd700'/%3E%3Crect x='11' y='8' width='10' height='10' fill='%234488ff'/%3E%3Crect x='11' y='18' width='4' height='6' fill='%234488ff'/%3E%3Crect x='17' y='18' width='4' height='6' fill='%234488ff'/%3E%3Crect x='22' y='10' width='3' height='12' fill='%23ffd700'/%3E%3Crect x='21' y='8' width='5' height='3' fill='%23ffd700' opacity='0.7'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODE SELECT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="mode-select" class="hidden overlay">
        <div class="mode-box">
            <h1 class="lobby-title">ARCANE FORMULA</h1>
            <p class="lobby-sub" style="margin-bottom:30px">Choose your path</p>
            <div class="mode-buttons">
                <button id="modePvp" class="mode-btn">
                    <div class="mode-icon-text">PVP</div>
                    <div class="mode-label">PVP ARENA</div>
                    <div class="mode-desc">Battle other mages online</div>
                </button>
                <button id="modeCampaign" class="mode-btn">
                    <div class="mode-icon-text">CO-OP</div>
                    <div class="mode-label">CAMPAIGN</div>
                    <div class="mode-desc">Clear dungeons solo or co-op</div>
                </button>
                <button id="modeSandbox" class="mode-btn">
                    <div class="mode-icon-text">‚öóÔ∏è</div>
                    <div class="mode-label">SANDBOX</div>
                    <div class="mode-desc">Test spells freely</div>
                </button>
            </div>
            <button id="modeContinue" class="btn-gold hidden" style="margin-top:18px;font-size:13px;">CONTINUE CAMPAIGN</button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PARTY LOBBY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="lobby" class="hidden overlay">
        <div class="lobby-box" style="max-width:500px">
            <h1 class="lobby-title">ARCANE FORMULA</h1>
            <p class="lobby-sub" id="lobbySub">Create or join a party</p>

            <!-- Create / Join row -->
            <div class="lobby-actions" id="lobbyActions">
                <button id="createRoom" class="btn-gold">CREATE PARTY</button>
                <div class="lobby-divider"><span>or</span></div>
                <div class="join-row">
                    <input id="roomCodeInput" type="text" placeholder="PARTY CODE" maxlength="6" spellcheck="false" autocomplete="off">
                    <button id="joinRoom" class="btn-gold">JOIN</button>
                </div>
                <button id="soloBtn" class="btn-gold hidden" style="margin-top:10px">PLAY SOLO</button>
            </div>

            <div id="roomStatus" class="room-status"></div>
            <div id="roomCodeDisplay" class="room-code hidden"></div>

            <!-- Party Panel (shown once connected) -->
            <div id="partyPanel" class="hidden" style="margin-top:20px">
                <div class="party-header">
                    <span class="party-code-label">PARTY</span>
                    <span class="party-code-value" id="partyCodeValue"></span>
                    <span style="color:#555;font-size:10px;margin-left:8px">(share this code)</span>
                </div>
                <div class="party-members" id="partyMembers"></div>

                <!-- Mode Picker (inside party) -->
                <div class="party-mode-picker" id="partyModePicker">
                    <div style="color:#888;font:10px monospace;letter-spacing:2px;margin-bottom:8px">SELECT MODE</div>
                    <div class="party-mode-grid">
                        <button class="party-mode-btn selected" data-mode="ffa">
                            <div class="pmb-icon">‚öîÔ∏è</div><div class="pmb-label">FREE FOR ALL</div>
                        </button>
                        <button class="party-mode-btn" data-mode="teams">
                            <div class="pmb-icon">üõ°Ô∏è</div><div class="pmb-label">TEAM DEATHMATCH</div>
                        </button>
                        <button class="party-mode-btn" data-mode="koth">
                            <div class="pmb-icon">üëë</div><div class="pmb-label">KING OF THE HILL</div>
                        </button>
                        <button class="party-mode-btn" data-mode="boss">
                            <div class="pmb-icon">üíÄ</div><div class="pmb-label">BOSS FIGHT</div>
                        </button>
                        <button class="party-mode-btn" data-mode="gauntlet">
                            <div class="pmb-icon">üî•</div><div class="pmb-label">BOSS GAUNTLET</div>
                        </button>
                        <button class="party-mode-btn" data-mode="survival">
                            <div class="pmb-icon">üåä</div><div class="pmb-label">SURVIVAL</div>
                        </button>
                        <button class="party-mode-btn" data-mode="target">
                            <div class="pmb-icon">üéØ</div><div class="pmb-label">TARGET PRACTICE</div>
                        </button>
                        <button class="party-mode-btn" data-mode="duel">
                            <div class="pmb-icon">‚ö°</div><div class="pmb-label">1v1 DUEL</div>
                        </button>
                        <button class="party-mode-btn" data-mode="campaign">
                            <div class="pmb-icon">üó∫Ô∏è</div><div class="pmb-label">CO-OP CAMPAIGN</div>
                        </button>
                    </div>
                </div>

                <button id="partyStartBtn" class="btn-gold" style="margin-top:16px;width:100%">START GAME</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPELLBOOK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="spellbook-ui" class="hidden overlay">
        <div class="spellbook-wrap">
            <div class="spellbook-topbar">
                <div class="spell-tabs" id="spellTabs"></div>
            </div>
            <div class="spell-dock" id="spellDock"></div>
            <div class="spellbook-main">
                <div class="spell-editor-panel" id="spellEditorPanel"></div>
                <div class="palette-panel">
                    <div class="palette-title">BLOCKS</div>
                    <div class="palette-scroll" id="blockPalette"></div>
                </div>
            </div>
            <div class="spellbook-bottom">
                <div id="readyStatus" class="ready-status"></div>
                <button id="readyBtn" class="btn-gold btn-ready">READY</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HUD (PvP) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="hud" class="hidden">
        <div class="hud-left">
            <div class="hud-label">YOU</div>
            <div class="hp-bar"><div id="player-hp" class="hp-fill"></div><span id="player-hp-text" class="bar-text">100</span></div>
            <div class="mana-bar"><div id="player-mana" class="mana-fill"></div><div id="player-mana-locked" class="mana-locked"></div><span id="player-mana-text" class="bar-text">100</span></div>
            <div class="spell-keys" id="spellKeys"></div>
        </div>
        <div class="hud-center">
            <div id="dash-cd" class="dash-cd"></div>
            <div id="pvp-mode-label" style="color:#ffd700;font:bold 10px monospace;margin-top:4px;opacity:0.6"></div>
        </div>
        <div class="hud-right">
            <div class="hud-label">SCOREBOARD</div>
            <div id="pvp-scoreboard" style="font:9px monospace;color:#888;line-height:1.5"></div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HUD (Sandbox) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="sandbox-hud" class="hidden">
        <div style="position:absolute;top:8px;left:50%;transform:translateX(-50%);color:#ffd700;font:bold 14px 'Courier New',monospace;text-align:center;text-shadow:0 0 6px #000;">
            SANDBOX MODE
            <div style="font-size:10px;color:#888;margin-top:2px;">Press 1-6 to cast spells ¬∑ Click to aim ¬∑ Infinite mana</div>
        </div>
        <div class="hud-left">
            <div class="hud-label">SANDBOX</div>
            <div class="mana-bar"><div id="sandbox-mana" class="mana-fill" style="width:100%"></div><span id="sandbox-mana-text" class="bar-text">100</span></div>
            <div class="spell-keys" id="sandbox-spellKeys"></div>
        </div>
        <div style="position:absolute;bottom:8px;left:50%;transform:translateX(-50%);">
            <button id="sandboxBackBtn" class="btn-gold" style="font-size:11px;padding:4px 16px;">BACK TO MENU</button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HUD (Campaign) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="campaign-hud" class="hidden">
        <div class="hud-left">
            <div class="hud-label">MAGE</div>
            <div class="hp-bar"><div id="camp-hp" class="hp-fill"></div><span id="camp-hp-text" class="bar-text">150</span></div>
            <div class="mana-bar"><div id="camp-mana" class="mana-fill"></div><span id="camp-mana-text" class="bar-text">100</span></div>
            <div class="spell-keys" id="camp-spellKeys"></div>
        </div>
        <div class="hud-center">
            <div id="camp-dash" class="dash-cd ready">DASH [SHIFT]</div>
            <div id="camp-enemies" class="enemy-count"></div>
            <div id="bot-controls" style="display:flex;gap:4px;margin-top:4px;">
                <button id="addBotBtn" onclick="Campaign.addBot()" style="font:8px monospace;background:#333;color:#cc66ff;border:1px solid #cc66ff;border-radius:3px;padding:2px 6px;cursor:pointer;">+ BOT</button>
                <button id="removeBotBtn" onclick="Campaign.removeBot()" style="font:8px monospace;background:#333;color:#ff6666;border:1px solid #ff6666;border-radius:3px;padding:2px 6px;cursor:pointer;">- BOT</button>
            </div>
        </div>
        <div class="hud-right" id="minimap-container">
            <canvas id="minimapCanvas" width="160" height="120"></canvas>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VICTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="victory-screen" class="hidden overlay">
        <h1 id="victory-text"></h1>
        <p id="victory-sub"></p>
        <div style="display:flex;gap:12px;margin-top:10px">
            <button id="restartBtn" class="btn-gold">REMATCH</button>
            <button id="backToPartyBtn" class="btn-gold" style="font-size:12px;padding:8px 20px;opacity:0.7">BACK TO PARTY</button>
        </div>
    </div>

    <script src="js/parser.js"></script>
    <script src="js/blocks.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/arcon.js"></script>
    <script src="js/intro.js"></script>
    <script src="js/cutscene.js"></script>
    <script src="js/spell-library.js"></script>
    <script src="js/loopholes.js"></script>
    <script src="js/spellbook.js"></script>
    <script src="js/network.js"></script>
    <script src="js/dungeon.js"></script>
    <script src="js/enemies.js"></script>
    <script src="js/battle.js"></script>
    <script src="js/campaign.js"></script>
    <script src="js/sandbox.js"></script>
    <script src="js/main.js"></script>
</body>
</html>