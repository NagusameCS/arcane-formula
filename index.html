<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Formula</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%230a0806'/%3E%3Crect x='13' y='2' width='6' height='6' fill='%23ffd700'/%3E%3Crect x='11' y='8' width='10' height='10' fill='%234488ff'/%3E%3Crect x='11' y='18' width='4' height='6' fill='%234488ff'/%3E%3Crect x='17' y='18' width='4' height='6' fill='%234488ff'/%3E%3Crect x='22' y='10' width='3' height='12' fill='%23ffd700'/%3E%3Crect x='21' y='8' width='5' height='3' fill='%23ffd700' opacity='0.7'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- MODE SELECT -->
    <div id="mode-select" class="hidden overlay">
        <div class="mode-box">
            <h1 class="lobby-title">ARCANE FORMULA</h1>
            <p class="lobby-sub" style="margin-bottom:30px">Choose your path</p>
            <div class="mode-buttons">
                <button id="modePvp" class="mode-btn">
                    <div class="mode-icon-text">PVP</div>
                    <div class="mode-label">PVP ARENA</div>
                    <div class="mode-desc">Duel another mage online</div>
                </button>
                <button id="modeCampaign" class="mode-btn">
                    <div class="mode-icon-text">CO-OP</div>
                    <div class="mode-label">CAMPAIGN</div>
                    <div class="mode-desc">Clear dungeons solo or co-op</div>
                </button>
                <button id="modeSandbox" class="mode-btn">
                    <div class="mode-icon-text">⚗️</div>
                    <div class="mode-label">SANDBOX</div>
                    <div class="mode-desc">Test spells freely</div>
                </button>
            </div>
            <button id="modeContinue" class="btn-gold hidden" style="margin-top:18px;font-size:13px;">CONTINUE CAMPAIGN</button>
        </div>
    </div>

    <!-- LOBBY -->
    <div id="lobby" class="hidden overlay">
        <div class="lobby-box">
            <h1 class="lobby-title">ARCANE FORMULA</h1>
            <p class="lobby-sub">Two mages. Their formulas. One arena.</p>
            <div class="lobby-actions">
                <button id="createRoom" class="btn-gold">CREATE ROOM</button>
                <div class="lobby-divider"><span>or</span></div>
                <div class="join-row">
                    <input id="roomCodeInput" type="text" placeholder="ROOM CODE" maxlength="6" spellcheck="false" autocomplete="off">
                    <button id="joinRoom" class="btn-gold">JOIN</button>
                </div>
                <button id="soloBtn" class="btn-gold hidden" style="margin-top:10px">PLAY SOLO</button>
                <div id="pvpRoomType" class="hidden" style="margin-top:12px;text-align:center;">
                    <div style="color:#888;font:10px 'Courier New',monospace;margin-bottom:4px;">ARENA MODE</div>
                    <select id="roomTypeSelect" style="background:#1a1510;color:#ffd700;border:1px solid #aa8800;border-radius:4px;padding:4px 8px;font:12px 'Courier New',monospace;cursor:pointer;">
                        <option value="ffa">Free For All</option>
                        <option value="boss">Boss Fight</option>
                        <option value="gauntlet">Boss Gauntlet</option>
                        <option value="duel">1v1 Duel</option>
                    </select>
                </div>
            </div>
            <div id="roomStatus" class="room-status"></div>
            <div id="roomCodeDisplay" class="room-code hidden"></div>
        </div>
    </div>

    <!-- SPELLBOOK -->
    <div id="spellbook-ui" class="hidden overlay">
        <div class="spellbook-wrap">
            <div class="spellbook-topbar">
                <div class="spell-tabs" id="spellTabs"></div>
            </div>
            <div class="spell-dock" id="spellDock"></div>
            <div class="spellbook-main">
                <div class="spell-editor-panel" id="spellEditorPanel"></div>
                <div class="palette-panel">
                    <div class="palette-title">BLOCKS</div>
                    <div class="palette-scroll" id="blockPalette"></div>
                </div>
            </div>
            <div class="spellbook-bottom">
                <div id="readyStatus" class="ready-status"></div>
                <button id="readyBtn" class="btn-gold btn-ready">READY</button>
            </div>
        </div>
    </div>

    <!-- HUD (PvP) -->
    <div id="hud" class="hidden">
        <div class="hud-left">
            <div class="hud-label">YOU</div>
            <div class="hp-bar"><div id="player-hp" class="hp-fill"></div><span id="player-hp-text" class="bar-text">100</span></div>
            <div class="mana-bar"><div id="player-mana" class="mana-fill"></div><div id="player-mana-locked" class="mana-locked"></div><span id="player-mana-text" class="bar-text">100</span></div>
            <div class="spell-keys" id="spellKeys"></div>
        </div>
        <div class="hud-center">
            <div id="dash-cd" class="dash-cd"></div>
        </div>
        <div class="hud-right">
            <div class="hud-label">ENEMY</div>
            <div class="hp-bar"><div id="enemy-hp" class="hp-fill hp-enemy"></div><span id="enemy-hp-text" class="bar-text">100</span></div>
            <div class="mana-bar"><div id="enemy-mana" class="mana-fill"></div><div id="enemy-mana-locked" class="mana-locked"></div></div>
        </div>
    </div>

    <!-- HUD (Sandbox) -->
    <div id="sandbox-hud" class="hidden">
        <div style="position:absolute;top:8px;left:50%;transform:translateX(-50%);color:#ffd700;font:bold 14px 'Courier New',monospace;text-align:center;text-shadow:0 0 6px #000;">
            SANDBOX MODE
            <div style="font-size:10px;color:#888;margin-top:2px;">Press 1-6 to cast spells · Click to aim · Infinite mana</div>
        </div>
        <div class="hud-left">
            <div class="hud-label">SANDBOX</div>
            <div class="mana-bar"><div id="sandbox-mana" class="mana-fill" style="width:100%"></div><span id="sandbox-mana-text" class="bar-text">100</span></div>
            <div class="spell-keys" id="sandbox-spellKeys"></div>
        </div>
        <div style="position:absolute;bottom:8px;left:50%;transform:translateX(-50%);">
            <button id="sandboxBackBtn" class="btn-gold" style="font-size:11px;padding:4px 16px;">BACK TO MENU</button>
        </div>
    </div>

    <!-- HUD (Campaign) -->
    <div id="campaign-hud" class="hidden">
        <div class="hud-left">
            <div class="hud-label">MAGE</div>
            <div class="hp-bar"><div id="camp-hp" class="hp-fill"></div><span id="camp-hp-text" class="bar-text">150</span></div>
            <div class="mana-bar"><div id="camp-mana" class="mana-fill"></div><span id="camp-mana-text" class="bar-text">100</span></div>
            <div class="spell-keys" id="camp-spellKeys"></div>
        </div>
        <div class="hud-center">
            <div id="camp-dash" class="dash-cd ready">DASH [SHIFT]</div>
            <div id="camp-enemies" class="enemy-count"></div>
            <div id="bot-controls" style="display:flex;gap:4px;margin-top:4px;">
                <button id="addBotBtn" onclick="Campaign.addBot()" style="font:8px monospace;background:#333;color:#cc66ff;border:1px solid #cc66ff;border-radius:3px;padding:2px 6px;cursor:pointer;">+ BOT</button>
                <button id="removeBotBtn" onclick="Campaign.removeBot()" style="font:8px monospace;background:#333;color:#ff6666;border:1px solid #ff6666;border-radius:3px;padding:2px 6px;cursor:pointer;">- BOT</button>
            </div>
        </div>
        <div class="hud-right" id="minimap-container">
            <canvas id="minimapCanvas" width="160" height="120"></canvas>
        </div>
    </div>

    <!-- VICTORY -->
    <div id="victory-screen" class="hidden overlay">
        <h1 id="victory-text"></h1>
        <p id="victory-sub"></p>
        <button id="restartBtn" class="btn-gold">REMATCH</button>
    </div>

    <script src="js/parser.js"></script>
    <script src="js/blocks.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/arcon.js"></script>
    <script src="js/intro.js"></script>
    <script src="js/cutscene.js"></script>
    <script src="js/spell-library.js"></script>
    <script src="js/loopholes.js"></script>
    <script src="js/spellbook.js"></script>
    <script src="js/network.js"></script>
    <script src="js/dungeon.js"></script>
    <script src="js/enemies.js"></script>
    <script src="js/battle.js"></script>
    <script src="js/campaign.js"></script>
    <script src="js/sandbox.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
